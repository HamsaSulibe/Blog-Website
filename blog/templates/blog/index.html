{% extends "blog/base.html" %}
{% block title %}Home{% endblock %}

{% block extra_head %}
<style>
.home-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}
.post-list{
  display:flex;
  flex-direction:column;
  gap:16px;
}
.post-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px 20px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
  transition:.3s;
}
.post-card:hover{ box-shadow:0 6px 16px rgba(0,0,0,.08); }
.post-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.post-author{font-weight:600; color:var(--active-bg);}
.post-date{font-size:13px; color:var(--muted);}
.post-title{margin:6px 0; font-size:18px; font-weight:700;}
.post-body{margin:6px 0 12px; line-height:1.5;}

/* actions */
.actions{
  display:flex;
  align-items:center;
  gap:12px;
}
.actions form{display:inline;}
.actions button,
.actions a{
  display:inline-flex;
  align-items:center;
  gap:4px;
  font-size:14px;
  padding:6px 10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  text-decoration:none;
  transition:.2s;
}
.actions button.like{
  background:var(--active-bg);
  color:#fff;
}
.actions button.unlike{
  background:#e5e7eb;
  color:var(--text);
}
.actions button.unlike:hover{background:#d1d5db;}
.actions a.edit{
  background:#2563eb;
  color:#fff;
}
.actions a.edit:hover{background:#1d4ed8;}
.actions a.delete{
  background:#dc2626;
  color:#fff;
}
.actions a.delete:hover{background:#b91c1c;}
.like-count{font-size:13px; color:var(--muted);}

/* زر أيقونة */
.icon-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
  border-radius:50%;
  background:var(--active-bg);
  color:#fff;
  transition:.2s;
}
.icon-btn:hover{
  background:var(--primary-hover);
}
.icon-btn svg{
  width:20px;
  height:20px;
}
</style>
{% endblock %}

{% block content %}
<div class="home-header">
  <h1>Home</h1>
  {% if user.is_authenticated %}
    <a href="{% url 'blog:post_create' %}" class="icon-btn" title="New Post">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
        <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/>
        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h6a1 1 0 110 2H4v10h10v-6a1 1 0 112 0v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/>
      </svg>
    </a>
  {% else %}
    <p>Please <a href="{% url 'login' %}">login</a> to create posts.</p>
  {% endif %}
</div>

{% if posts %}
  <div class="post-list">
    {% for post in posts %}
      <div class="post-card">
        <div class="post-header">
          <span class="post-author">@{{ post.author.username }}</span>
          <span class="post-date">{{ post.created_at|date:"Y-m-d H:i" }}</span>
        </div>
        <h3 class="post-title">{{ post.title }}</h3>
        <p class="post-body">{{ post.body }}</p>

        <div class="actions">
          <form method="post" action="{% url 'blog:toggle_like' post.id %}">
            {% csrf_token %}
            {% if post.id in liked_posts %}
              <button type="submit" class="unlike">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                  <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 18.657l-6.828-6.829a4 4 0 010-5.656z"/>
                </svg>
                Unlike
              </button>
            {% else %}
              <button type="submit" class="like">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                  <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 18.657l-6.828-6.829a4 4 0 010-5.656z"/>
                </svg>
                Like
              </button>
            {% endif %}
          </form>
          <span class="like-count">{{ post.likes.count }} likes</span>

          {% if post.author == user %}
            <a href="{% url 'blog:post_edit' post.id %}" class="edit">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/>
                <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h6a1 1 0 110 2H4v10h10v-6a1 1 0 112 0v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/>
              </svg>
              Edit
            </a>
            <a href="{% url 'blog:post_delete' post.id %}" class="delete">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H3a1 1 0 100 2h1v10a2 2 0 002 2h8a2 2 0 002-2V6h1a1 1 0 100-2h-2V3a1 1 0 00-1-1H6zm2 4a1 1 0 012 0v8a1 1 0 11-2 0V6zm4 0a1 1 0 012 0v8a1 1 0 11-2 0V6z" clip-rule="evenodd"/>
              </svg>
              Delete
            </a>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>No posts yet.</p>
{% endif %}
{% endblock %}
